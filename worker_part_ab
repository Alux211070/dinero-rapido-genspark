=await r(s));return c&&(s.finalized===!1||h)&&(s.res=c),s}},ss=Symbol(),ns=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof pr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?is(e,{all:r,dot:s}):{}};async function is(e,t){const r=await e.formData();return r?as(r,t):{}}function as(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?ls(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(os(r,s,n),delete r[s])}),r}var ls=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},os=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,l)=>{l===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},hr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},cs=e=>{const{groups:t,path:r}=ds(e),s=hr(r);return hs(s,t)},ds=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},hs=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},Ue={},fs=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return Ue[s]||(r[2]?Ue[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ue[s]=[e,r[1],!0]),Ue[s]}return null},Rt=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},us=e=>Rt(e,decodeURI),fr=e=>{const t=e.url,r=t.indexOf("/",t.charCodeAt(9)===58?13:8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),l=t.slice(r,i===-1?void 0:i);return us(l.includes("%25")?l.replace(/%25/g,"%2525"):l)}else if(n===63)break}return t.slice(r,s)},ms=e=>{const t=fr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ue=(e,t,...r)=>(r.length&&(t=ue(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),ur=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,l)=>l.indexOf(n)===i)},at=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Rt(e,gr):e):e,mr=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let l=e.indexOf(`?${t}`,8);for(l===-1&&(l=e.indexOf(`&${t}`,8));l!==-1;){const o=e.charCodeAt(l+t.length+1);if(o===61){const c=l+t.length+2,h=e.indexOf("&",c);return at(e.slice(c,h===-1?void 0:h))}else if(o==38||isNaN(o))return"";l=e.indexOf(`&${t}`,l+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const l=e.indexOf("&",i+1);let o=e.indexOf("=",i);o>l&&l!==-1&&(o=-1);let c=e.slice(i+1,o===-1?l===-1?void 0:l:o);if(s&&(c=at(c)),i=l,c==="")continue;let h;o===-1?h="":(h=e.slice(o+1,l===-1?void 0:l),s&&(h=at(h))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(h)):n[c]??(n[c]=h)}return t?n[t]:n},gs=mr,ps=(e,t)=>mr(e,t,!0),gr=decodeURIComponent,Nt=e=>Rt(e,gr),pe,N,K,vr,xr,gt,G,Vt,pr=(Vt=class{constructor(e,t="/",r=[[]]){w(this,K);p(this,"raw");w(this,pe);w(this,N);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});w(this,G,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,x(this,N,r),x(this,pe,{})}param(e){return e?k(this,K,vr).call(this,e):k(this,K,xr).call(this)}query(e){return gs(this.url,e)}queries(e){return ps(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await ns(this,e))}json(){return d(this,G).call(this,"text").then(e=>JSON.parse(e))}text(){return d(this,G).call(this,"text")}arrayBuffer(){return d(this,G).call(this,"arrayBuffer")}blob(){return d(this,G).call(this,"blob")}formData(){return d(this,G).call(this,"formData")}addValidatedData(e,t){d(this,pe)[e]=t}valid(e){return d(this,pe)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[ss](){return d(this,N)}get matchedRoutes(){return d(this,N)[0].map(([[,e]])=>e)}get routePath(){return d(this,N)[0].map(([[,e]])=>e)[this.routeIndex].path}},pe=new WeakMap,N=new WeakMap,K=new WeakSet,vr=function(e){const t=d(this,N)[0][this.routeIndex][1][e],r=k(this,K,gt).call(this,t);return r?/\%/.test(r)?Nt(r):r:void 0},xr=function(){const e={},t=Object.keys(d(this,N)[0][this.routeIndex][1]);for(const r of t){const s=k(this,K,gt).call(this,d(this,N)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?Nt(s):s)}return e},gt=function(e){return d(this,N)[1]?d(this,N)[1][e]:e},G=new WeakMap,Vt),vs="text/plain; charset=UTF-8",lt=(e,t)=>({"Content-Type":e,...t}),$e,Le,U,ve,q,L,Ne,xe,ye,ne,De,Me,X,me,Kt,xs=(Kt=class{constructor(e,t){w(this,X);w(this,$e);w(this,Le);p(this,"env",{});w(this,U);p(this,"finalized",!1);p(this,"error");w(this,ve);w(this,q);w(this,L);w(this,Ne);w(this,xe);w(this,ye);w(this,ne);w(this,De);w(this,Me);p(this,"render",(...e)=>(d(this,xe)??x(this,xe,t=>this.html(t)),d(this,xe).call(this,...e)));p(this,"setLayout",e=>x(this,Ne,e));p(this,"getLayout",()=>d(this,Ne));p(this,"setRenderer",e=>{x(this,xe,e)});p(this,"header",(e,t,r)=>{this.finalized&&x(this,L,new Response(d(this,L).body,d(this,L)));const s=d(this,L)?d(this,L).headers:d(this,ne)??x(this,ne,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});p(this,"status",e=>{x(this,ve,e)});p(this,"set",(e,t)=>{d(this,U)??x(this,U,new Map),d(this,U).set(e,t)});p(this,"get",e=>d(this,U)?d(this,U).get(e):void 0);p(this,"newResponse",(...e)=>k(this,X,me).call(this,...e));p(this,"body",(e,t,r)=>k(this,X,me).call(this,e,t,r));p(this,"text",(e,t,r)=>!d(this,ne)&&!d(this,ve)&&!t&&!r&&!this.finalized?new Response(e):k(this,X,me).call(this,e,t,lt(vs,r)));p(this,"json",(e,t,r)=>k(this,X,me).call(this,JSON.stringify(e),t,lt("application/json",r)));p(this,"html",(e,t,r)=>{const s=n=>k(this,X,me).call(this,n,t,lt("text/html; charset=UTF-8",r));return typeof e=="object"?sr(e,er.Stringify,!1,{}).then(s):s(e)});p(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});p(this,"notFound",()=>(d(this,ye)??x(this,ye,()=>new Response),d(this,ye).call(this,this)));x(this,$e,e),t&&(x(this,q,t.executionCtx),this.env=t.env,x(this,ye,t.notFoundHandler),x(this,Me,t.path),x(this,De,t.matchResult))}get req(){return d(this,Le)??x(this,Le,new pr(d(this,$e),d(this,Me),d(this,De))),d(this,Le)}get event(){if(d(this,q)&&"respondWith"in d(this,q))return d(this,q);throw Error("This context has no FetchEvent")}get executionCtx(){if(d(this,q))return d(this,q);throw Error("This context has no ExecutionContext")}get res(){return d(this,L)||x(this,L,new Response(null,{headers:d(this,ne)??x(this,ne,new Headers)}))}set res(e){if(d(this,L)&&e){e=new Response(e.body,e);for(const[t,r]of d(this,L).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=d(this,L).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}x(this,L,e),this.finalized=!0}get var(){return d(this,U)?Object.fromEntries(d(this,U)):{}}},$e=new WeakMap,Le=new WeakMap,U=new WeakMap,ve=new WeakMap,q=new WeakMap,L=new WeakMap,Ne=new WeakMap,xe=new WeakMap,ye=new WeakMap,ne=new WeakMap,De=new WeakMap,Me=new WeakMap,X=new WeakSet,me=function(e,t,r){const s=d(this,L)?new Headers(d(this,L).headers):d(this,ne)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[l,o]of i)l.toLowerCase()==="set-cookie"?s.append(l,o):s.set(l,o)}if(r)for(const[i,l]of Object.entries(r))if(typeof l=="string")s.set(i,l);else{s.delete(i);for(const o of l)s.append(i,o)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??d(this,ve);return new Response(e,{status:n,headers:s})},Kt),A="ALL",ys="all",bs=["get","post","put","delete","options","patch"],yr="Can not add a route since the matcher is already built.",br=class extends Error{},ws="__COMPOSED_HANDLER",Es=e=>e.text("404 Not Found",404),Dt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},M,O,Er,H,re,ze,Ge,zt,wr=(zt=class{constructor(t={}){w(this,O);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");w(this,M,"/");p(this,"routes",[]);w(this,H,Es);p(this,"errorHandler",Dt);p(this,"onError",t=>(this.errorHandler=t,this));p(this,"notFound",t=>(x(this,H,t),this));p(this,"fetch",(t,...r)=>k(this,O,Ge).call(this,t,r[1],r[0],t.method));p(this,"request",(t,r,s,n)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${ue("/",t)}`,r),s,n)));p(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(k(this,O,Ge).call(this,t.request,t,void 0,t.request.method))})});[...bs,ys].forEach(i=>{this[i]=(l,...o)=>(typeof l=="string"?x(this,M,l):k(this,O,re).call(this,i,d(this,M),l),o.forEach(c=>{k(this,O,re).call(this,i,d(this,M),c)}),this)}),this.on=(i,l,...o)=>{for(const c of[l].flat()){x(this,M,c);for(const h of[i].flat())o.map(f=>{k(this,O,re).call(this,h.toUpperCase(),d(this,M),f)})}return this},this.use