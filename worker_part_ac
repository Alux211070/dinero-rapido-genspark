=(i,...l)=>(typeof i=="string"?x(this,M,i):(x(this,M,"*"),l.unshift(i)),l.forEach(o=>{k(this,O,re).call(this,A,d(this,M),o)}),this);const{strict:s,...n}=t;Object.assign(this,n),this.getPath=s??!0?t.getPath??fr:ms}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{var l;let i;r.errorHandler===Dt?i=n.handler:(i=async(o,c)=>(await Lt([],r.errorHandler)(o,()=>n.handler(o,c))).res,i[ws]=n.handler),k(l=s,O,re).call(l,n.method,n.path,i)}),this}basePath(t){const r=k(this,O,Er).call(this);return r._basePath=ue(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=c=>c:n=s.replaceRequest));const l=i?c=>{const h=i(c);return Array.isArray(h)?h:[h]}:c=>{let h;try{h=c.executionCtx}catch{}return[c.env,h]};n||(n=(()=>{const c=ue(this._basePath,t),h=c==="/"?0:c.length;return f=>{const u=new URL(f.url);return u.pathname=u.pathname.slice(h)||"/",new Request(u,f)}})());const o=async(c,h)=>{const f=await r(n(c.req.raw),...l(c));if(f)return f;await h()};return k(this,O,re).call(this,A,ue(t,"*"),o),this}},M=new WeakMap,O=new WeakSet,Er=function(){const t=new wr({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,x(t,H,d(this,H)),t.routes=this.routes,t},H=new WeakMap,re=function(t,r,s){t=t.toUpperCase(),r=ue(this._basePath,r);const n={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)},ze=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ge=function(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await k(this,O,Ge).call(this,t,r,s,"GET")))();const i=this.getPath(t,{env:s}),l=this.router.match(n,i),o=new xs(t,{path:i,matchResult:l,env:s,executionCtx:r,notFoundHandler:d(this,H)});if(l[0].length===1){let h;try{h=l[0][0][0][0](o,async()=>{o.res=await d(this,H).call(this,o)})}catch(f){return k(this,O,ze).call(this,f,o)}return h instanceof Promise?h.then(f=>f||(o.finalized?o.res:d(this,H).call(this,o))).catch(f=>k(this,O,ze).call(this,f,o)):h??d(this,H).call(this,o)}const c=Lt(l[0],this.errorHandler,d(this,H));return(async()=>{try{const h=await c(o);if(!h.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return h.res}catch(h){return k(this,O,ze).call(this,h,o)}})()},zt),et="[^/]+",Pe=".*",Ae="(?:|/.*)",ge=Symbol(),Rs=new Set(".\\+*[^]$()");function Cs(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Pe||e===Ae?1:t===Pe||t===Ae?-1:e===et?1:t===et?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ie,ae,I,Gt,pt=(Gt=class{constructor(){w(this,ie);w(this,ae);w(this,I,Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(d(this,ie)!==void 0)throw ge;if(i)return;x(this,ie,r);return}const[l,...o]=t,c=l==="*"?o.length===0?["","",Pe]:["","",et]:l==="/*"?["","",Ae]:l.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let h;if(c){const f=c[1];let u=c[2]||et;if(f&&c[2]&&(u===".*"||(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u))))throw ge;if(h=d(this,I)[u],!h){if(Object.keys(d(this,I)).some(m=>m!==Pe&&m!==Ae))throw ge;if(i)return;h=d(this,I)[u]=new pt,f!==""&&x(h,ae,n.varIndex++)}!i&&f!==""&&s.push([f,d(h,ae)])}else if(h=d(this,I)[l],!h){if(Object.keys(d(this,I)).some(f=>f.length>1&&f!==Pe&&f!==Ae))throw ge;if(i)return;h=d(this,I)[l]=new pt}h.insert(o,r,s,n,i)}buildRegExpStr(){const r=Object.keys(d(this,I)).sort(Cs).map(s=>{const n=d(this,I)[s];return(typeof d(n,ae)=="number"?`(${s})@${d(n,ae)}`:Rs.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof d(this,ie)=="number"&&r.unshift(`#${d(this,ie)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},ie=new WeakMap,ae=new WeakMap,I=new WeakMap,Gt),tt,He,Xt,ks=(Xt=class{constructor(){w(this,tt,{varIndex:0});w(this,He,new pt)}insert(e,t,r){const s=[],n=[];for(let l=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const h=`@\\${l}`;return n[l]=[h,c],l++,o=!0,h}),!o)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let l=n.length-1;l>=0;l--){const[o]=n[l];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(o)!==-1){i[c]=i[c].replace(o,n[l][1]);break}}return d(this,He).insert(i,t,s,d(this,tt),r),s}buildRegExp(){let e=d(this,He).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,l)=>i!==void 0?(r[++t]=Number(i),"$()"):(l!==void 0&&(s[Number(l)]=++t),"")),[new RegExp(`^${e}`),r,s]}},tt=new WeakMap,He=new WeakMap,Xt),Rr=[],Ss=[/^$/,[],Object.create(null)],Xe=Object.create(null);function Cr(e){return Xe[e]??(Xe[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ps(){Xe=Object.create(null)}function As(e){var h;const t=new ks,r=[];if(e.length===0)return Ss;const s=e.map(f=>[!/\*|\/:/.test(f[0]),...f]).sort(([f,u],[m,v])=>f?1:m?-1:u.length-v.length),n=Object.create(null);for(let f=0,u=-1,m=s.length;f<m;f++){const[v,y,g]=s[f];v?n[y]=[g.map(([E])=>[E,Object.create(null)]),Rr]:u++;let b;try{b=t.insert(y,u,v)}catch(E){throw E===ge?new br(y):E}v||(r[u]=g.map(([E,R])=>{const S=Object.create(null);for(R-=1;R>=0;R--){const[C,T]=b[R];S[C]=T}return[E,S]}))}const[i,l,o]=t.buildRegExp();for(let f=0,u=r.length;f<u;f++)for(let m=0,v=r[f].length;m<v;m++){const y=(h=r[f][m])==null?void 0:h[1];if(!y)continue;const g=Object.keys(y);for(let b=0,E=g.length;b<E;b++)y[g[b]]=o[y[g[b]]]}const c=[];for(const f in l)c[f]=r[l[f]];return[i,c,n]}function he(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Cr(r).test(t))return[...e[r]]}}var Z,J,Re,kr,Sr,Zt,Os=(Zt=class{constructor(){w(this,Re);p(this,"name","RegExpRouter");w(this,Z);w(this,J);x(this,Z,{[A]:Object.create(null)}),x(this,J,{[A]:Object.create(null)})}add(e,t,r){var o;const s=d(this,Z),n=d(this,J);if(!s||!n)throw new Error(yr);s[e]||[s,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[A]).forEach(h=>{c[e][h]=[...c[A][h]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=Cr(t);e===A?Object.keys(s).forEach(h=>{var f;(f=s[h])[t]||(f[t]=he(s[h],t)||he(s[A],t)||[])}):(o=s[e])[t]||(o[t]=he(s[e],t)||he(s[A],t)||[]),Object.keys(s).forEach(h=>{(e===A||e===h)&&Object.keys(s[h]).forEach(f=>{c.test(f)&&s[h][f].push([r,i])})}),Object.keys(n).forEach(h=>{(e===A||e===h)&&Object.keys(n[h]).forEach(f=>c.test(f)&&n[h][f].push([r,i]))});return}const l=ur(t)||[t];for(let c=0,h=l.length;c<h;c++){const f=l[c];Object.keys(n).forEach(u=>{var m;(e===A||e===u)&&((m=n[u])[f]||(m[f]=[...he(s[u],f)||he(s[A],f)||[]]),n[u][f].push([r,i-h+c+1]))})}}match(e,t){Ps();const r=k(this,Re,kr).call(this);return this.match=(s,n)=>{const i=r[s]||r[A],l=i[2][n];if(l)return l;const o=n.match(i[0]);if(!o)return[[],Rr];const c=o.indexOf("",1);return[i[1][c],o]},this.match(e,t)}},Z=new WeakMap,J=new WeakMap,Re=new WeakSet,kr=function(){const e=Object.create(null);return Object.keys(d(this,J)).concat(Object.keys(d(this,Z))).forEach(t=>{e[t]||(e[t]=k(this,Re,Sr).call(this,t))}),x(this,Z,x(this,J,void 0)),e},Sr=function(e){const t=[];let r=e===A;return[d(this,Z),d(this,J)].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==A&&t.push(...Object.keys(s[A]).map(i=>[i,s[A][i]]))}),r?As(t):null},Zt),Y,W,Jt,js=(Jt=class{constructor(e){p(this,"name","SmartRouter");w(this,Y,[]);w(this,W,[]);x(this,Y,e.routers)}add(e,t,r){if(!d(this,W))throw new Error(yr);d(this,W).push([e,t,r])}match(e,t){if(!d(this,W))throw new Error("Fatal error");const r=d(this,Y),s=d(this,W),n=r.length;let i=0,l;for(;i<n;i++){const o=r[i];try{for(let c=0,h=s.length;c<h;c++)o.add(...s[c]);l=o.match(e,t)}catch(c){if(c instanceof br)continue;throw c}this.match=o.match.bind(o),x(this,Y,[o]),x(this,W,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,l}get activeRouter(){if(d(this,W)||d(this,Y).length!==1)throw new Error("No active router has been determined yet.");return d(this,Y)[0]}},Y=new WeakMap,W=new WeakMap,Jt),ke=Object.create(null),Q,$,le,be,j,V,se,Yt,Pr=(Yt=class{constructor(e,t,r){w(this,V);w(this,Q);w(this,$);w(this,le);w(this,be,0);w(this,j,ke);if(x(this,$,r||Object.create(null)),x(this,Q,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},x(this,Q,[s])}x(this,le,[])}insert(e,t,r){x(this,be,++Pt(this,be)._);let s=this;const n=cs(t),i=[];for(let l=0,o=n.length;l<o;l++){const c=n[l],h=n[l+1],f=fs(c,h),u=Array.isArray(f)?f[0]:c;if(u in d(s,$)){s=d(s,$)[u],f&&i.push(f[1]);continue}d(s,$)[u]=new Pr,f&&(d(s,le).push(f),i.push(f[1])),s=d(s,$)[u]}return d(s,Q).push({[e]:{handler:r,possibleKeys:i.filter((l,o,c)=>c.indexOf(l)===o),score:d(this,be)}}),s}search(e,t){var o;const r=[];x(this,j,ke);let n=[this];const i=hr(t),l=[];for(let c=0,h=i.length;c<h;c++){const f=i[c],u=c===h-1,m=[];for(let v=0,y=n.length;v<y;v++){const g=n[v],b=d(g,$)[f];b&&(x(b,j,d(g,j)),u?(d(b,$)["*"]&&r.push(...k(this,V,se).call(this,d(b,$)["*"],e,d(g,j))),r.push(...k(this,V,se).call(this,b,e,d(g,j)))):m.push(b));for(let E=0,R=d(g,le).length;E<R;E++){const S=d(g,le)[E],C=d(g,j)===ke?{}:{...d(g,j)};if(S==="*"){const z=d(g,$)["*"];z&&(r.push(...k(this,V,se).call(this,z,e,d(g,j))),x(z,j,C),m.push(z));continue}const[T,de,te]=S;if(!f&&!(te instanceof RegExp))continue;const _=d(g,$)[T],Ir=i.slice(c).join("/");if(te instanceof RegExp){const z=te.exec(Ir);if(z){if(C[de]=z[0],r.push(...k(this,V,se).call(this,_,e,d(g,j),C)),Object.keys(d(_,$)).length){x(_,j,C);const rt=((o=z[0].match(/\//))==null?void 0:o.length)??0;(l[rt]||(l[rt]=[])).push(_)}continue}}(te===!0||te.test(f))&&(C[de]=f,u?(r.push(...k(this,V,se).call(this,_,e,C,d(g,j))),d(_,$)["*"]&&r.push(...k(this,V,se).call(this,d(_,$)["*"],e,C,d(g,j)))):(x(_,j,C),m.push(_)))}}n=m.concat(l.shift()??[])}return r.length>1&&r.sort((c,h)=>c.score-h.score),[r.map(({handler:c,params:h})=>[c,h])]}},Q=new WeakMap,$=new WeakMap,le=new WeakMap,be=new WeakMap,j=new WeakMap,V=new WeakSet,se=function(e,t,r,s){const n=[];for(let i=0,l=d(e,Q).length;i<l;i++){const